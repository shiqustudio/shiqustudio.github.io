function MapboxLanguage(e){if(e=Object.assign({},e),!(this instanceof MapboxLanguage))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=e.defaultLanguage,this._isLanguageField=e.languageField||/^\{name/,this._getLanguageField=e.getLanguageField||function(t){return t==="mul"?"{name}":"{name_"+t+"}"},this._languageSource=e.languageSource||null,this._languageTransform=e.languageTransform||function(e,t){return t==="ar"?noSpacing(e):standardSpacing(e)},this._excludedLayerIds=e.excludedLayerIds||[],this.supportedLanguages=e.supportedLanguages||["ar","en","es","fr","de","ja","ko","mul","pt","ru","zh"]}function standardSpacing(e){var t=e.layers.map(function(e){if(!(e.layout||{})["text-field"])return e;var t=0;return e["source-layer"]==="state_label"&&(t=.15),e["source-layer"]==="marine_label"&&(/-lg/.test(e.id)&&(t=.25),/-md/.test(e.id)&&(t=.15),/-sm/.test(e.id)&&(t=.1)),e["source-layer"]==="place_label"&&(/-suburb/.test(e.id)&&(t=.15),/-neighbour/.test(e.id)&&(t=.1),/-islet/.test(e.id)&&(t=.01)),e["source-layer"]==="airport_label"&&(t=.01),e["source-layer"]==="rail_station_label"&&(t=.01),e["source-layer"]==="poi_label"&&/-scalerank/.test(e.id)&&(t=.01),e["source-layer"]==="road_label"&&(/-label-/.test(e.id)&&(t=.01),/-shields/.test(e.id)&&(t=.05)),Object.assign({},e,{layout:Object.assign({},e.layout,{"text-letter-spacing":t})})});return Object.assign({},e,{layers:t})}function noSpacing(e){var t=e.layers.map(function(e){if(!(e.layout||{})["text-field"])return e;var t=0;return Object.assign({},e,{layout:Object.assign({},e.layout,{"text-letter-spacing":t})})});return Object.assign({},e,{layers:t})}function isNameStringField(e,t){return typeof t=="string"&&e.test(t)}function isNameFunctionField(e,t){return t.stops&&t.stops.filter(function(t){return e.test(t[1])}).length>0}function adaptPropertyLanguage(e,t,n){if(isNameStringField(e,t))return n;if(isNameFunctionField(e,t)){var s=t.stops.map(function(t){return e.test(t[1])?[t[0],n]:t});return Object.assign({},t,{stops:s})}return t}function changeLayerTextProperty(e,t,n,s){return t.layout&&t.layout["text-field"]&&s.indexOf(t.id)===-1?Object.assign({},t,{layout:Object.assign({},t.layout,{"text-field":adaptPropertyLanguage(e,t.layout["text-field"],n)})}):t}function findStreetsSource(e){var t=Object.keys(e.sources).filter(function(t){var n=e.sources[t];return/mapbox-streets-v\d/.test(n.url)});return t[0]}MapboxLanguage.prototype.setLanguage=function(e,t){if(this.supportedLanguages.indexOf(t)<0)throw new Error("Language "+t+" is not supported");var s,o,i,a,r,n=this._languageSource||findStreetsSource(e);return n?(s=this._getLanguageField(t),o=this._isLanguageField,i=this._excludedLayerIds,a=e.layers.map(function(e){return e.source===n?changeLayerTextProperty(o,e,s,i):e}),r=Object.assign({},e,{layers:a}),this._languageTransform(r,t)):e},MapboxLanguage.prototype._initialStyleUpdate=function(){var e=this._map.getStyle(),t=this._defaultLanguage||browserLanguage(this.supportedLanguages);this._map.off("styledata",this._initialStyleUpdate),this._map.setStyle(this.setLanguage(e,t))};function browserLanguage(e){var n=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,s=n.split("-"),t=n;return s.length>1&&(t=s[0]),e.indexOf(t)>-1?t:null}MapboxLanguage.prototype.onAdd=function(e){return this._map=e,this._map.on("styledata",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},MapboxLanguage.prototype.onRemove=function(){this._map.off("styledata",this._initialStyleUpdate),this._map=void 0};function ie11Polyfill(){typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(t){"use strict";if(t===null)throw new TypeError("Cannot convert undefined or null to object");for(var s,i,a=Object(t),o=1;o<arguments.length;o++)if(s=arguments[o],s!==null)for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(a[i]=s[i]);return a},writable:!0,configurable:!0})}typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=MapboxLanguage:(ie11Polyfill(),window.MapboxLanguage=MapboxLanguage)